# Discord RPG 商店機器人

一個功能完整的Discord RPG商店機器人，支援商店系統、背包系統、角色卡、簽到獎勵等功能。

## ✨ 主要功能

### 🏪 商店系統
- ✅ 用戶可創建多個商店（例如A商店、B商店）
- ✅ 自定義商店名稱、橫幅圖片、貨幣名稱和圖示
- ✅ 商品可設置：名稱、價格、類別、描述、圖片
- ✅ 商品屬性：可使用/不可使用、可轉售/不可轉售、消耗品/永久物品、非賣品
- ✅ 使用物品時可顯示自定義描述
- ✅ 商店瀏覽界面帶分頁功能

### 🎒 背包系統
- ✅ 每個用戶都有獨立的背包和金幣餘額
- ✅ 可按類別篩選物品
- ✅ 使用物品功能（消耗品會減少數量，永久物品可重複使用）
- ✅ 物品詳細信息顯示

### ⚔️ 角色系統
- ✅ 創建RPG角色卡
- ✅ 可自定義的屬性：HP、MP、攻擊力、防禦力、等級、經驗值
- ✅ 精美的角色卡顯示界面，帶血量/魔力條

### 💰 經濟系統
- ✅ 每日簽到獲得金幣
- ✅ 連續簽到記錄
- ✅ 身份組收入加成系統（管理員可設置）
- ✅ 玩家之間可以贈送金幣

## 📦 安裝說明

### 本地運行

1. **安裝Python依賴**
```bash
pip install -r requirements.txt
```

2. **設置Discord Bot**
   - 前往 [Discord Developer Portal](https://discord.com/developers/applications)
   - 創建新應用程式
   - 在 "Bot" 頁面創建機器人
   - 複製 Bot Token
   - 在 "OAuth2" > "URL Generator" 選擇：
     - Scopes: `bot`, `applications.commands`
     - Bot Permissions: `Administrator` 或所需的權限

3. **配置環境變數**
```bash
cp .env.example .env
# 編輯 .env 文件，填入你的 DISCORD_TOKEN
```

4. **運行機器人**
```bash
python bot.py
```

## 🚀 Railway 部署

### 步驟1: 準備Repository

1. 將所有文件推送到GitHub repository：
```bash
git init
git add .
git commit -m "Initial commit"
git remote add origin your-repo-url
git push -u origin main
```

### 步驟2: 在Railway部署

1. 前往 [Railway.app](https://railway.app)
2. 點擊 "New Project"
3. 選擇 "Deploy from GitHub repo"
4. 選擇你的repository
5. Railway會自動檢測Python項目並開始部署

### 步驟3: 設置環境變數

在Railway項目設置中添加環境變數：
- `DISCORD_TOKEN`: 你的Discord Bot Token

### 步驟4: 部署完成

Railway會自動：
- 安裝依賴（requirements.txt）
- 運行bot.py
- 保持機器人24/7在線

## 📖 指令列表

### 商店相關
- `/創建商店` - 創建一個新商店
- `/我的商店` - 查看你擁有的所有商店
- `/添加商品 [商店id]` - 向指定商店添加商品
- `/查看商店 [用戶] [商店id]` - 查看某個商店
- `/商品設置 [商店id] [商品編號]` - 設置商品屬性（可使用、可轉售、消耗品）
- `/修改使用描述 [商店id] [商品編號] [描述]` - 修改物品使用時的描述

### 背包相關
- `/背包` - 查看你的背包
  - 在背包界面可以：
    - 🛒 使用物品
    - 📁 切換類別查看
    - ◀️▶️ 翻頁

### 角色相關
- `/創建角色` - 創建你的RPG角色
- `/角色卡 [用戶]` - 查看角色信息（可查看其他人）

### 經濟相關
- `/簽到` - 每日簽到獲得獎勵
- `/贈送金幣 [用戶] [金額]` - 贈送金幣給其他玩家
- `/添加收入身份組 [身份組] [每日收入]` - 設置身份組簽到加成（管理員）
- `/收入身份組列表` - 查看所有收入身份組

### 其他
- `/幫助` - 顯示所有可用指令

## 🎮 使用範例

### 創建商店流程
1. 使用 `/創建商店` 創建商店
2. 填寫商店名稱、貨幣名稱、貨幣符號、橫幅URL
3. 使用 `/我的商店` 查看商店ID（例如：shop_1）
4. 使用 `/添加商品 shop_1` 添加商品
5. 設置商品名稱、價格、類別、描述、圖片

### 設置商品屬性
1. 使用 `/商品設置 shop_1 item_1` 打開設置面板
2. 點擊按鈕切換：
   - **可使用** - 玩家是否能使用此物品
   - **可轉售** - 玩家是否能轉售此物品
   - **消耗型** - 使用後是否消失（關閉則可重複使用）

### 設置物品使用效果
```
/修改使用描述 shop_1 item_1 你使用了治療藥水，恢復了50點生命值！感覺身體充滿了活力。
```

### 購買和使用物品
1. 玩家使用 `/查看商店 @店主 shop_1` 瀏覽商店
2. 點擊 🛒 購買按鈕，選擇商品
3. 使用 `/背包` 查看購買的物品
4. 點擊 ✨ 使用物品按鈕
5. 選擇要使用的物品，會顯示你設置的使用描述

## 💾 數據存儲

所有數據存儲在 `data/` 目錄下的JSON文件：
- `shops.json` - 商店數據
- `users.json` - 用戶數據（餘額、背包、角色）
- `characters.json` - 角色數據
- `checkins.json` - 簽到記錄
- `income_roles.json` - 收入身份組設置

**注意**: Railway部署時，數據會在容器重啟時丟失。如需持久化存儲，建議：
1. 使用Railway的持久存儲卷
2. 或連接外部數據庫（如MongoDB）

## 🎨 特色功能

### 1. 多商店管理
一個用戶可以創建多個商店，每個商店有獨立的：
- 商店名稱和描述
- 貨幣系統（自定義名稱和圖示）
- 商品列表
- 橫幅圖片

### 2. 靈活的物品系統
- **非賣品**: 設置價格為0，只展示不出售
- **永久物品**: 關閉"消耗型"，物品使用後不消失
- **自定義使用描述**: 每個物品都能設置獨特的使用效果描述
- **物品分類**: 自由設置類別，背包可按類別篩選

### 3. 身份組經濟系統
- 管理員可設置特定身份組的簽到加成
- 玩家簽到時自動計算所有身份組的加成
- 支援多個身份組的收入累加

### 4. 互動式界面
- 使用Discord的按鈕和選擇菜單
- 分頁瀏覽，避免信息過載
- Modal表單輸入，體驗更好

## 🔧 自定義開發

### 添加新的角色屬性
在 `CreateCharacterModal` 類中添加新的 `TextInput`：
```python
strength = discord.ui.TextInput(
    label='力量',
    placeholder='例如: 10',
    required=True,
    max_length=10
)
```

### 添加新的商品屬性
在 `AddItemModal` 的 `on_submit` 方法中添加新欄位：
```python
shops[user_id][self.shop_id]['items'][item_id] = {
    # ... 現有欄位 ...
    "rarity": "普通",  # 新增稀有度
    "level_requirement": 1,  # 新增等級需求
}
```

## ⚠️ 注意事項

1. **Token安全**: 絕對不要將 `.env` 文件或 Discord Token 提交到公開的repository
2. **數據備份**: 定期備份 `data/` 目錄
3. **權限設置**: 確保機器人有足夠的權限（建議使用Administrator或自行配置所需權限）
4. **Railway限制**: 
   - 免費方案有使用時數限制
   - 容器重啟會丟失本地文件
   - 建議升級到付費方案或使用外部數據庫

## 🐛 問題排查

### 機器人無法啟動
- 檢查 `DISCORD_TOKEN` 是否正確設置
- 確認網絡連接正常
- 查看控制台錯誤信息

### 斜線指令不顯示
- 確保機器人已被邀請到伺服器
- 檢查機器人是否有 `applications.commands` 權限
- 等待幾分鐘讓Discord同步指令

### 數據丟失
- Railway重啟會清空容器，導致數據丟失
- 建議定期導出數據或使用外部數據庫

## 📝 授權

此項目為開源項目，可自由修改和使用。

## 🤝 貢獻

歡迎提交Issue和Pull Request！

## 📧 聯繫

如有問題，歡迎在GitHub開Issue討論。

---

祝你使用愉快！ 🎉